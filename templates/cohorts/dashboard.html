{% extends 'base.html' %}

{% block title %}Today's Tasks - Intentional Tech{% endblock %}

{% block content %}

<!-- Enrolled state -->
<header>
    <h1>{{ cohort.name }}</h1>
</header>

<!-- Cohort Information -->
<section>
    <p><small>{{ cohort.start_date|date:"F d, Y" }} – {{ cohort.end_date|date:"F d, Y" }}</small></p>
    <p><small>There are {{ enrollment_count }} people rethinking their digital habits with you!</small></p>
</section>

<!-- Tasks Section -->
<section>
    <h2>Today's Tasks</h2>

    {% if tasks %}
        <!-- Vertical list of tasks -->
        {% for task in tasks %}
        <article style="margin-bottom: 1rem;">
            <h3><a href="{{ task.url }}">{{ task.title|safe }}</a></h3>
            {% if task.estimated_time_minutes %}<p><small>~{{ task.estimated_time_minutes }} min</small></p>{% endif %}
            <p>{{ task.description|safe }}</p>
        </article>
        {% endfor %}
    {% else %}
        <!-- No tasks state -->
        <article>
            <p>There's nothing to do but seize the day!</p>
        </article>
    {% endif %}
</section>

{% if upcoming_tasks %}
<!-- Upcoming Tasks Section -->
<section>
    <h2>Upcoming Tasks</h2>
    <ul>
        {% for task in upcoming_tasks %}
        <li>{{ task.title }} — <strong>{{ task.frequency }}{% if task.day_of_week %}, {{ task.day_of_week }}{% endif %}</strong>{% if task.estimated_time_minutes %} (~{{ task.estimated_time_minutes }} min){% endif %}</li>
        {% endfor %}
    </ul>
</section>
{% endif %}

{% if user.profile.view_past_submissions %}
<!-- All Tasks / Past Submissions -->
<section>
    <h2>Previous Submissions</h2>
    <ul>
        {% for scheduler in cohort.task_schedulers.all %}
            {% if scheduler.id in submitted_scheduler_ids %}
            <li>
                <a href="/cohorts/{{ cohort.id }}/tasks/{{ scheduler.slug }}/submissions/">{{ scheduler.survey.title|default:scheduler.slug }}</a>
            </li>
            {% endif %}
        {% endfor %}
    </ul>
</section>
{% endif %}

{% endblock %}
