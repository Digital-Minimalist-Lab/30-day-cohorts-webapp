{% extends 'base.html' %}

{% block title %}Today's Tasks - Intentional Tech{% endblock %}

{% block content %}

<!-- Dashboard Header -->
<header class="dashboard-header">
    <h1>{{ cohort.name }}</h1>
    <p class="text-muted">
        {{ cohort.start_date|date:"F d, Y" }} – {{ cohort.end_date|date:"F d, Y" }}
        <span class="dashboard-header__separator">•</span>
        {{ enrollment_count }} people rethinking their digital habits with you
    </p>
</header>

<!-- Today's Tasks -->
<section>
    <h2>Today's Tasks</h2>

    {% if tasks %}
    <div class="card card--medium card--blue card--border-left card--border-accented">
        <ul>
        {% for task in tasks %}
            <li>
                <div class="card__row">
                    <h4><a href="{{ task.url }}">{{ task.title|safe }}</a></h4>
                    {% if task.estimated_time_minutes %}<span class="card__meta">~{{ task.estimated_time_minutes }} min</span>{% endif %}
                </div>
                <p>{{ task.description|safe }}</p>
            </li>
        {% endfor %}

        </ul>
    </div>
    {% else %}
    <div class="card card--medium card--blue">
        <p>✨ There's nothing to do but seize the day!</p>
    </div>
    {% endif %}
</section>

{% if upcoming_tasks %}
<!-- Upcoming Tasks -->
<section>
    <h2>Upcoming Tasks</h2>
    <div class="card card--medium card--blue">
        <ul>
            {% for task in upcoming_tasks %}
            <li>
                <div class="card__row">
                    {{ task.title }}
                    <span class="card__meta">
                        {{ task.frequency }}{% if task.day_of_week %}, {{ task.day_of_week }}{% endif %}
                        {% if task.estimated_time_minutes %}(~{{ task.estimated_time_minutes }} min){% endif %}
                    </span>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</section>
{% endif %}

{% if user.profile.view_past_submissions %}
<!-- All Tasks / Past Submissions -->
<section>
    <h2>Previous Submissions</h2>
    <div class="card card--medium card--blue">
        <ul>
            {% for scheduler in cohort.task_schedulers.all %}
                {% if scheduler.id in submitted_scheduler_ids %}
                <li>
                    <a href="/cohorts/{{ cohort.id }}/tasks/{{ scheduler.slug }}/submissions/">{{ scheduler.survey.title|default:scheduler.slug }}</a>
                </li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
</section>
{% endif %}

{% endblock %}
