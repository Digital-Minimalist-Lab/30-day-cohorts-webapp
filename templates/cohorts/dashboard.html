{% extends 'base.html' %}

{% block title %}Today's Tasks - Intentional Tech{% endblock %}

{% block content %}

<!-- Dashboard Header -->
<header class="dashboard-header">
    <h1>{{ cohort.name }}</h1>
    <p class="text-muted">
        {{ cohort.start_date|date:"F d, Y" }} – {{ cohort.end_date|date:"F d, Y" }}
        <span class="dashboard-header__separator">•</span>
        {{ enrollment_count }} people rethinking their digital habits with you
    </p>
</header>

<!-- Today's Tasks -->
<section>
    <h2>Today's Tasks</h2>

    {% if tasks %}
    <div>
        {% for task in tasks %}
        <article class="card card--medium">
            <hgroup>
                <h3><a href="{{ task.url }}">{{ task.title|safe }}</a></h3>
            </hgroup>
            {% if task.estimated_time_minutes %}<small>~{{ task.estimated_time_minutes }} min</small>{% endif %}
            <p>{{ task.description|safe }}</p>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="card card--info card--medium">
        <p>✨ There's nothing to do but seize the day!</p>
    </div>
    {% endif %}
</section>

{% if upcoming_tasks %}
<!-- Upcoming Tasks -->
<section>
    <h2>Upcoming</h2>
    <div class="card card--info card--medium">
        <ul>
            {% for task in upcoming_tasks %}
            <li>
                {{ task.title }}
                <span class="list__meta">
                    {{ task.frequency }}{% if task.day_of_week %}, {{ task.day_of_week }}{% endif %}
                    {% if task.estimated_time_minutes %}(~{{ task.estimated_time_minutes }} min){% endif %}
                </span>
            </li>
            {% endfor %}
        </ul>
    </div>
</section>
{% endif %}

{% if user.profile.view_past_submissions %}
<!-- All Tasks / Past Submissions -->
<section>
    <h2>Previous Submissions</h2>
    <ul>
        {% for scheduler in cohort.task_schedulers.all %}
            {% if scheduler.id in submitted_scheduler_ids %}
            <li>
                <a href="/cohorts/{{ cohort.id }}/tasks/{{ scheduler.slug }}/submissions/">{{ scheduler.survey.title|default:scheduler.slug }}</a>
            </li>
            {% endif %}
        {% endfor %}
    </ul>
</section>
{% endif %}

{% endblock %}
