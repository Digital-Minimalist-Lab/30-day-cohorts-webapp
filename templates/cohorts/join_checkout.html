{% extends 'base.html' %}

{% block title %}Checkout - Intentional Tech{% endblock %}

{% block content %}
<div class="content-centered">

    <hgroup>
        <h1>Complete Your Enrollment</h1>
        <p>Choose an amount that feels meaningful to you</p>
    </hgroup>

    <div>

        <!-- Summary Card -->
        <section class="card card--large card--blue">
            <hgroup>
                <h2>What You're Getting</h2>
                <p>{{ cohort.name }}</p>
            </hgroup>

            <p>{{ cohort.start_date|date:"F j, Y" }} ‚Äì {{ cohort.end_date|date:"F j, Y" }}</p>

            <ul>
                <li>30 days of guided digital declutter</li>
                <li>Daily prompts & reflection journal</li>
                <li>Weekly intention setting</li>
                <li>Progress tracking dashboard</li>
                <li>Post-cohort maintenance plan</li>
            </ul>
        </section>

        <!-- Payment Form -->
        <section class="card card--large">
            <h2>Choose Your Commitment</h2>

            <p>
                <strong>Why pay?</strong> Research shows that financial commitment significantly increases completion rates.
                Choose an amount that feels meaningful to you to lock in your intention.
            </p>
            <p>
                <small>Your contribution also supports the development of this open-source project and funds scholarships for those who can't afford it.</small>
            </p>

            {% if minimum_price_dollars != 0 %}
            <p>Minimum: <strong>${{ minimum_price_dollars|floatformat:0 }}</strong></p>
            {% endif %}

            <form method="post">
                {% csrf_token %}

                <!-- Quick Select Buttons -->
                <div class="grid">
                    {% for amount in quick_select_amounts %}
                    <button type="button" class="secondary amount-btn" data-amount="{{ amount }}">
                        {% if amount == 0 %}Free{% else %}${{ amount }}{% endif %}
                    </button>
                    {% endfor %}
                </div>

                <!-- Amount Input -->
                <label for="{{ form.amount.id_for_label }}">
                    Or Enter Custom Amount (USD)
                    <input type="number"
                           name="{{ form.amount.name }}"
                           id="{{ form.amount.id_for_label }}"
                           value="{{ amount.value|default:minimum_price_dollars|floatformat:0 }}"
                           min="{{ minimum_price_dollars|floatformat:0 }}"
                           step="1"
                           required
                           class="amount-input">
                    {% if form.amount.errors %}
                    <small>{{ form.amount.errors.0 }}</small>
                    {% endif %}
                    {% if form.amount.help_text %}
                    <small>{{ form.amount.help_text }}</small>
                    {% endif %}
                </label>

                <button type="submit" class="submit-btn">
                    Commit & Join Cohort
                </button>
            </form>

            <div class="guarantee-box">
                <strong>üõ°Ô∏è 100% Money-Back Guarantee</strong>
                <p>Change your mind before the start date? Get a full refund, no questions asked.</p>
            </div>

            <p class="payment-footer">
                <small>
                    üîí Secure payment via Stripe ‚Ä¢
                    <a href="{% url 'core:privacy' %}">Privacy Policy</a>
                </small>
            </p>
        </section>

    </div>
</div>

<script>
// Handle quick select buttons
document.querySelectorAll('.amount-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const amount = this.getAttribute('data-amount');
        const input = document.getElementById('{{ form.amount.id_for_label }}');
        input.value = amount;
        
        // Visual feedback
        document.querySelectorAll('.amount-btn').forEach(b => {
            b.classList.remove('primary');
            b.classList.add('secondary');
        });
        this.classList.remove('secondary');
        this.classList.add('primary');
    });
});

// Pre-select button if value matches
const currentVal = document.getElementById('{{ form.amount.id_for_label }}').value;
document.querySelectorAll('.amount-btn').forEach(btn => {
    if (btn.getAttribute('data-amount') === currentVal) {
        btn.click();
    }
});

// Prevent double submission
document.querySelector('form').addEventListener('submit', function(e) {
    const submitBtn = this.querySelector('button[type="submit"]');
    if (submitBtn.disabled) {
        e.preventDefault();
        return false;
    }
    submitBtn.disabled = true;
    submitBtn.textContent = 'Processing...';
});
</script>

<style>


.payment-footer {
    text-align: center;
    margin-top: 1.5rem;
    color: var(--pico-muted-color);
    font-size: 0.9rem;
}

.guarantee-box {
    margin-top: 1.5rem;
    padding: 1rem;
    background-color: var(--pico-card-background-color);
    border: 1px dashed var(--pico-muted-color);
    border-radius: var(--radius);
    text-align: center;
    font-size: 0.9rem;
}
.guarantee-box p { margin-bottom: 0; }
</style>
{% endblock %}
