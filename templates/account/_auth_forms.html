
{% load account %}
{% load static %}

<div style="max-width: 500px; margin-inline: auto;">
    <sl-tab-group>
        <sl-tab slot="nav" panel="login" {% if "/login" in request.path %}active{% endif %}>Login</sl-tab>
        <sl-tab slot="nav" panel="signup" {% if "/login" not in request.path %}active{% endif %}>Create Account</sl-tab>

        <!-- Login Panel -->
        <sl-tab-panel name="login" {% if "/login" in request.path %}active{% endif %}>
            {% if login_form %}
            <form method="post" action="{% url 'account_login' %}">
                {% csrf_token %}
                
                {% if login_form.non_field_errors %}
                <article>
                    {{ login_form.non_field_errors }}
                </article>
                {% endif %}

                <label for="{{ login_form.login.id_for_label }}">
                    Email
                    <input type="email" 
                           name="{{ login_form.login.name }}" 
                           id="{{ login_form.login.id_for_label }}"
                           value="{{ login_form.login.value|default:'' }}"
                           autofocus
                           required>
                    {% if login_form.login.errors %}
                    <small>{{ login_form.login.errors.0 }}</small>
                    {% endif %}
                </label>
                
                <label for="{{ login_form.password.id_for_label }}">
                    Password
                    <input type="password" 
                           name="{{ login_form.password.name }}" 
                           id="{{ login_form.password.id_for_label }}"
                           required>
                    {% if login_form.password.errors %}
                    <small>{{ login_form.password.errors.0 }}</small>
                    {% endif %}
                </label>
                
                {% if login_form.remember %}
                <label for="{{ login_form.remember.id_for_label }}">
                    <input type="checkbox" 
                           name="{{ login_form.remember.name }}" 
                           id="{{ login_form.remember.id_for_label }}"
                           role="switch">
                    Remember me
                </label>
                {% endif %}
                
                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
                {% else %}
                <input type="hidden" name="next" value="{% url 'cohorts:join_checkout' %}">
                {% endif %}
                
                <button type="submit" style="width: 100%;">
                    {% if cohort and cohort.is_paid %}Continue to Payment{% else %}Continue{% endif %}
                </button>
            </form>
            
            <p style="text-align: center; margin-top: 1rem;">
                <small><a href="{% url 'account_reset_password' %}">Forgot password?</a></small>
            </p>
            {% endif %}
        </sl-tab-panel>

        <!-- Signup Panel -->
        <sl-tab-panel name="signup" {% if "/login" not in request.path %}active{% endif %}>
            {% if signup_form %}
            <form method="post" action="{% url 'account_signup' %}">
                {% csrf_token %}
                
                {% if signup_form.non_field_errors %}
                <article>
                    {{ signup_form.non_field_errors }}
                </article>
                {% endif %}

                <label for="{{ signup_form.email.id_for_label }}">
                    Email
                    <input type="email" 
                           name="{{ signup_form.email.name }}" 
                           id="{{ signup_form.email.id_for_label }}"
                           value="{{ signup_form.email.value|default:'' }}"
                           required>
                    {% if signup_form.email.errors %}
                    <small>{{ signup_form.email.errors.0 }}</small>
                    {% endif %}
                    {% if signup_form.email.help_text %}
                    <small>{{ signup_form.email.help_text }}</small>
                    {% endif %}
                </label>
                
                <label for="{{ signup_form.password1.id_for_label }}">
                    Password
                    <input type="password" 
                           name="{{ signup_form.password1.name }}" 
                           id="{{ signup_form.password1.id_for_label }}"
                           required>
                    {% if signup_form.password1.errors %}
                    <small>{{ signup_form.password1.errors.0 }}</small>
                    {% endif %}
                    {% if signup_form.password1.help_text %}
                    <small>{{ signup_form.password1.help_text }}</small>
                    {% endif %}
                </label>
                
                {% if signup_form.password2 %}
                <label for="{{ signup_form.password2.id_for_label }}">
                    Password (again)
                    <input type="password" 
                           name="{{ signup_form.password2.name }}" 
                           id="{{ signup_form.password2.id_for_label }}"
                           required>
                    {% if signup_form.password2.errors %}
                    <small>{{ signup_form.password2.errors.0 }}</small>
                    {% endif %}
                </label>
                {% endif %}
                
                <label for="signup-timezone">
                    Your Timezone
                    <select name="timezone" id="signup-timezone" required>
                        <option value="America/New_York" selected>Eastern (New York)</option>
                        <option value="America/Chicago">Central (Chicago)</option>
                        <option value="America/Denver">Mountain (Denver)</option>
                        <option value="America/Los_Angeles">Pacific (Los Angeles)</option>
                        <option value="America/Anchorage">Alaska</option>
                        <option value="Pacific/Honolulu">Hawaii</option>
                        <option value="Europe/London">London (UK)</option>
                        <option value="Europe/Paris">Paris (Central Europe)</option>
                        <option value="Asia/Tokyo">Tokyo</option>
                        <option value="Australia/Sydney">Sydney</option>
                        <option value="UTC">UTC</option>
                    </select>
                    <small>For accurate daily check-in dates</small>
                </label>
                
                <fieldset>
                    <legend>Email Reminders (Optional)</legend>
                    <label>
                        <input type="checkbox" name="email_daily_reminder" role="switch">
                        Daily check-in reminders
                    </label>
                    <label>
                        <input type="checkbox" name="email_weekly_reminder" role="switch">
                        Weekly reflection reminders
                    </label>
                </fieldset>

                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
                {% else %}
                <input type="hidden" name="next" value="{% url 'cohorts:join_checkout' %}">
                {% endif %}
                
                <button type="submit" style="width: 100%;">
                    Create Account & {% if cohort and cohort.is_paid %}Continue to Payment{% else %}Get Started{% endif %}
                </button>
            </form>
            
            <p style="text-align: center; margin-top: 1rem; color: var(--pico-muted-color);">
                <small>
                    By creating an account, you agree to our 
                    <a href="{% url 'accounts:privacy' %}">Privacy Policy</a>
                </small>
            </p>
            {% endif %}
        </sl-tab-panel>
    </sl-tab-group>
</div>

<style>
sl-tab-group {
    --indicator-color: var(--brand);
}

sl-tab-panel {
    padding: 2rem 0.5rem;
}

fieldset {
    border: 1px solid var(--pico-border-color);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
}

fieldset legend {
    font-weight: 600;
    font-size: 0.95rem;
}

fieldset label {
    margin-bottom: 0.5rem;
}
</style>
